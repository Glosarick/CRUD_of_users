(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const M="/api";async function J(t){const e=await t.text();if(!e)return null;try{return JSON.parse(e)}catch{return null}}async function T(t){const e=await J(t);if(!t.ok){const i=e&&typeof e=="object"&&"error"in e&&typeof e.error=="string"?e.error:`API error ${t.status}`,r=new Error(i);throw r.status=t.status,r}return e}async function H(t="",e=1,i=10){const r=new URLSearchParams;t&&r.set("q",t),r.set("page",String(e)),r.set("limit",String(i));const n=await fetch(`${M}/users/all?${r.toString()}`),a=await T(n);return Array.isArray(a)?{users:a,total:a.length,page:1,limit:i}:a??{users:[],total:0,page:1,limit:i}}async function G(t){const e=await fetch(`${M}/users/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:t})});return T(e)}async function R(t){const e=await fetch(`${M}/users/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:t})});return T(e)}async function V(t){const e=await fetch(`${M}/users/delete/${t}`,{method:"DELETE"});return T(e)}function Y(){const t=document.getElementById("modal"),e=document.getElementById("modal-title"),i=document.getElementById("user-id"),r=document.getElementById("user-created"),n=document.getElementById("user-name"),a=document.getElementById("user-email"),c=document.getElementById("user-form"),y=document.getElementById("save-btn");let d={};c.addEventListener("submit",async o=>{o.preventDefault();const p={id:i.value||void 0,created:r.value||void 0,name:n.value.trim(),email:a.value.trim()};d.onSubmit&&await d.onSubmit(p)});const L=document.getElementById("cancel-btn");L&&L.addEventListener("click",()=>{d.onCancel&&d.onCancel(),E()});function I(o,p){d=p||{};const s=!!(o&&o.id!==void 0&&o.id!==null&&o.id!=="");e.textContent=d.title||(s?"Editar usuario":"Agregar usuario"),y.textContent=d.submitLabel||(s?"Guardar cambios":"Crear"),i.value=o&&o.id?String(o.id):"",r.value=o&&o.created?String(o.created):"",n.value=o&&o.name?o.name:"",a.value=o&&o.email?o.email:"",t.setAttribute("aria-hidden","false"),t.classList.add("open"),n.focus()}function E(){t.setAttribute("aria-hidden","true"),t.classList.remove("open"),c.reset(),y.textContent="Crear"}return{open:I,close:E}}function F(t,e){function i(r,n,a){const c=Math.max(1,Math.ceil(r/a));t.innerHTML="";const y=document.createElement("span");y.className="pagination-info",y.textContent=`Página ${n} de ${c}`,t.appendChild(y);const d=document.createElement("div");d.className="pagination-controls",t.appendChild(d);const L=s=>{const l="http://www.w3.org/2000/svg",g=document.createElementNS(l,"svg");g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("width","16"),g.setAttribute("height","16"),g.setAttribute("aria-hidden","true");const h=document.createElementNS(l,"path");return h.setAttribute("fill","currentColor"),s==="left"?h.setAttribute("d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"):h.setAttribute("d","M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6z"),g.appendChild(h),g},I=(s,l,g,h)=>{const f=document.createElement("button");if(h){f.classList.add("icon-btn");const q=L(h);if(h==="left"){f.appendChild(q);const w=document.createElement("span");w.textContent=` ${s}`,f.appendChild(w)}else{const w=document.createElement("span");w.textContent=`${s} `,f.appendChild(w),f.appendChild(L(h))}}else f.textContent=s;return l&&(f.disabled=!0),f.addEventListener("click",g),d.appendChild(f),f};I("Anterior",n<=1,()=>e(Math.max(1,n-1)),"left");const E=7;let o=Math.max(1,n-Math.floor(E/2)),p=o+E-1;if(p>c&&(p=c,o=Math.max(1,p-E+1)),o>1){const s=document.createElement("button");if(s.textContent="1",s.addEventListener("click",()=>e(1)),d.appendChild(s),o>2){const l=document.createElement("span");l.textContent="...",d.appendChild(l)}}for(let s=o;s<=p;s++){const l=document.createElement("button");l.textContent=String(s),s===n&&l.classList.add("active"),l.addEventListener("click",()=>e(s)),d.appendChild(l)}if(p<c){if(p<c-1){const l=document.createElement("span");l.textContent="...",d.appendChild(l)}const s=document.createElement("button");s.textContent=String(c),s.addEventListener("click",()=>e(c)),d.appendChild(s)}I("Siguiente",n>=c,()=>e(Math.min(c,n+1)),"right")}return{render:i}}const D=document.getElementById("app");D.innerHTML=`
  <div class="users-container">
    <h1>Usuarios</h1>
    <div class="toolbar">
      <div class="search-group">
        <input id="search-input" placeholder="Buscar por nombre, apellidos o email" />
        <button type="button" id="clear-search-btn" class="clear-search-btn hidden" aria-label="Limpiar búsqueda">&times;</button>
      </div>
      <label for="limit-select">Mostrar:</label>
      <select id="limit-select">
        <option value="5" selected>5</option>
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
      </select>
      <button id="open-add-btn">Agregar usuario</button>
    </div>

    <div id="notifications" class="toast-container" aria-live="polite"></div>

    <div class="table-wrap">
      <table id="users-table">
        <thead><tr><th>Nombre</th><th>Email</th><th>Acciones</th></tr></thead>
        <tbody id="users-tbody"></tbody>
      </table>
    </div>

    <div class="pagination" id="pagination"></div>
  <div id="error-panel" class="error-panel hidden"></div>
  <div id="spinner" class="spinner hidden">Cargando...</div>

    <!-- Modal markup -->
    <div id="modal" class="modal" role="dialog" aria-hidden="true">
      <div class="modal-content">
        <h2 id="modal-title"></h2>
        <form id="user-form">
          <input type="hidden" id="user-id" />
          <input type="hidden" id="user-created" />
          <div class="form-row"><label>Nombre</label><input id="user-name" required /></div>
          <div class="form-row"><label>Email</label><input id="user-email" type="email" required /></div>
          <div class="form-actions">
            <button type="submit" id="save-btn">Guardar</button>
            <button type="button" id="cancel-btn">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

  </div>
`;const B=document.getElementById("users-tbody"),O=document.getElementById("notifications"),u=document.getElementById("search-input"),x=document.getElementById("clear-search-btn"),P=document.getElementById("limit-select");let S=[],k=0,b=1,C=Number(P.value)||5;function m(t,e="info",i=3500){if(!O)return;const r=document.createElement("div");r.className=`toast toast--${e}`,r.setAttribute("role",e==="error"?"alert":"status"),r.textContent=t,O.appendChild(r),requestAnimationFrame(()=>r.classList.add("show"));const n=()=>{r.classList.remove("show"),r.addEventListener("transitionend",()=>r.remove(),{once:!0})},a=window.setTimeout(n,i);r.addEventListener("click",()=>{window.clearTimeout(a),n()})}const U=t=>t.trim().toLowerCase();async function j(t,e){const i=U(t);if(!i)return!1;if(S.some(n=>U(n.email)===i&&(e===void 0||String(n.id)!==String(e))))return!0;try{const n=await H(i,1,5);return(n&&typeof n=="object"&&"users"in n?n.users||[]:[]).some(c=>U(c.email)===i&&(e===void 0||String(c.id)!==String(e)))}catch(n){return console.warn("No se pudo validar el email de manera anticipada",n),!1}}function A(){if(!x)return;const t=u.value.trim().length>0;x.classList.toggle("hidden",!t)}function $(t,e){if(typeof t=="string")return t;if(t&&typeof t=="object"){const i=t.message;if(typeof i=="string"&&i.trim()){const r=i.trim(),n=r.toLowerCase();return r==="Email already exists"||r==="API error 409"?"Ya existe un usuario con ese email":r==="User not found"?"Usuario no encontrado":n.includes("failed to fetch")?"No se pudo conectar con la API.":r}}return e}function K(t){const e=document.getElementById("error-panel");e.classList.remove("hidden"),e.innerHTML="";const i=document.createElement("p");i.textContent=t,e.appendChild(i);const r=document.createElement("button");r.textContent="Reintentar",r.addEventListener("click",()=>{e.classList.add("hidden"),v(u.value.trim())}),e.appendChild(r)}function z(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")}const N=Y(),_=F(document.getElementById("pagination"),t=>{b=t,v(u.value.trim())});function Q(t){B.innerHTML="";for(const e of t){const i=document.createElement("tr");i.innerHTML=`
      <td>${z(e.name)}</td>
      <td>${z(e.email)}</td>
      <td>
        <button class="edit-btn" data-id="${e.id}">Editar</button>
        <button class="delete-btn" data-id="${e.id}">Eliminar</button>
      </td>
    `,B.appendChild(i)}}async function v(t=""){const e=document.getElementById("spinner");e.classList.remove("hidden");try{const i=await H(t,b,C);S=i.users||[],k=i.total||S.length,b=i.page||b,C=i.limit||C,Q(S),_.render(k,b,C)}catch(i){K("No se puede conectar con la API. Asegúrate de que el servidor está levantado."),B.innerHTML="",console.error(i)}finally{e.classList.add("hidden"),A()}}x&&x.addEventListener("click",()=>{if(!u.value.trim()){u.value="",A(),u.focus();return}u.value="",b=1,A(),v(""),u.focus()});document.getElementById("open-add-btn").addEventListener("click",()=>{N.open(void 0,{title:"Agregar usuario",submitLabel:"Crear",onSubmit:async t=>{try{const e=t.email.trim();if(await j(e)){m("Ya existe un usuario con ese email","warning");return}const i={id:-1,name:t.name.trim(),email:e,created:new Date().toISOString()},r=await G(i),n=r&&typeof r=="object"&&"user"in r?r.user:r;m("Usuario creado correctamente","success"),N.close();const a=n&&(n.email||n.name)||"";u.value=a,A(),b=1,await v(a.trim())}catch(e){const i=$(e,"Error al crear usuario");m(i,"error"),console.error(e)}},onCancel:()=>m("Operación cancelada","info")})});B.addEventListener("click",async t=>{const e=t.target;if(e.matches(".delete-btn")){const i=e.getAttribute("data-id");if(!confirm("¿Eliminar este usuario?"))return;try{await V(i),m("Usuario eliminado correctamente","error"),await v(u.value.trim())}catch(r){m($(r,"Error al eliminar usuario"),"error"),console.error(r)}}else if(e.matches(".edit-btn")){const i=Number(e.getAttribute("data-id")),r=S.find(n=>Number(n.id)===Number(i));if(!r){m("Usuario no encontrado","warning");return}N.open(r,{title:"Editar usuario",submitLabel:"Guardar cambios",onSubmit:async n=>{try{const a=n.email.trim();if(await j(a,n.id)){m("Ya existe un usuario con ese email","warning");return}await R({id:Number(n.id),name:n.name.trim(),email:a,created:n.created||new Date().toISOString()}),m("Usuario actualizado correctamente","success"),N.close(),await v(u.value.trim())}catch(a){m($(a,"Error al actualizar usuario"),"error"),console.error(a)}},onCancel:()=>m("Operación cancelada","info")})}});const W=(t,e=250)=>{let i=null;return(...r)=>{i&&clearTimeout(i),i=setTimeout(()=>t(...r),e)}},X=W(t=>{b=1,v(t.target.value.trim())},300);u.addEventListener("input",t=>{A(),X(t)});P.addEventListener("change",()=>{C=Number(P.value)||10,b=1,v(u.value.trim())});v(u.value.trim());
